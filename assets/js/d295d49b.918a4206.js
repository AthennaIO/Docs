"use strict";(self.webpackChunk_athenna_docs=self.webpackChunk_athenna_docs||[]).push([[7806],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return u}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),d=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=d(a),u=i,f=p["".concat(l,".").concat(u)]||p[u]||m[u]||r;return a?n.createElement(f,o(o({ref:t},c),{},{components:a})):n.createElement(f,o({ref:t},c))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var d=2;d<r;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},397:function(e,t,a){a.r(t),a.d(t,{contentTitle:function(){return l},default:function(){return p},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return c}});var n=a(7462),i=a(3366),r=(a(7294),a(3905)),o=["components"],s={sidebar_position:5,id:"factories",title:"Factories",hide_title:!0,hide_table_of_contents:!0,tags:["ORM","Database","Factories"]},l=void 0,d={unversionedId:"orm/factories",id:"orm/factories",title:"Factories",description:"\ud83c\udfe0",source:"@site/docs/orm/factories.mdx",sourceDirName:"orm",slug:"/orm/factories",permalink:"/docs/orm/factories",editUrl:"https://github.com/AthennaIO/Docs/docs/orm/factories.mdx",tags:[{label:"ORM",permalink:"/docs/tags/orm"},{label:"Database",permalink:"/docs/tags/database"},{label:"Factories",permalink:"/docs/tags/factories"}],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,id:"factories",title:"Factories",hide_title:!0,hide_table_of_contents:!0,tags:["ORM","Database","Factories"]},sidebar:"tutorialSidebar",previous:{title:"Resources",permalink:"/docs/orm/resources"},next:{title:"Extending Models",permalink:"/docs/orm/extending-models"}},c=[{value:"Introduction",id:"id-introduction",children:[],level:2},{value:"Defining model factories",id:"id-defining-model-factories",children:[],level:2},{value:"Generating models using factories",id:"id-generating-models-using-factories",children:[{value:"Instantiating models",id:"id-instantiating-models",children:[],level:3},{value:"Overriding attributes",id:"id-overriding-attributes",children:[],level:3},{value:"Persisting models",id:"id-persisting-models",children:[],level:3},{value:"Generating soft deleted models",id:"id-generating-soft-deleted-models",children:[],level:3},{value:"Defining relationships within factories",id:"id-defining-relationships-within-factories",children:[],level:3}],level:2}],m={toc:c};function p(e){var t=e.components,a=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("nav",{"aria-label":"breadcrumbs"},(0,r.kt)("ul",{class:"breadcrumbs"},(0,r.kt)("li",{class:"breadcrumbs__item"},(0,r.kt)("a",{class:"breadcrumbs__link",href:"/"},"\ud83c\udfe0")),(0,r.kt)("li",{class:"breadcrumbs__item"},(0,r.kt)("a",{class:"breadcrumbs__link"},"ORM")),(0,r.kt)("li",{class:"breadcrumbs__item"},(0,r.kt)("a",{class:"breadcrumbs__link",href:"/docs/orm/factories"},"Factories")))),(0,r.kt)("span",{class:"badge badge--secondary margin-top-bot"},"version 1.0.0"),(0,r.kt)("h1",{id:"orm-factories"},"ORM: Factories"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("h4",{parentName:"li",id:"introduction"},(0,r.kt)("a",{parentName:"h4",href:"#id-introduction"},"Introduction"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("h4",{parentName:"li",id:"defining-model-factories"},(0,r.kt)("a",{parentName:"h4",href:"#id-defining-model-factories"},"Defining model factories"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("h4",{parentName:"li",id:"generating-models-using-factories"},(0,r.kt)("a",{parentName:"h4",href:"#id-generating-models-using-factories"},"Generating models using factories")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("h4",{parentName:"li",id:"instantiating-models"},(0,r.kt)("a",{parentName:"h4",href:"#id-instantiating-models"},"Instantiating models"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("h4",{parentName:"li",id:"overriding-attributes"},(0,r.kt)("a",{parentName:"h4",href:"#id-overriding-attributes"},"Overriding attributes"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("h4",{parentName:"li",id:"persisting-models"},(0,r.kt)("a",{parentName:"h4",href:"#id-persisting-models"},"Persisting models"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("h4",{parentName:"li",id:"generating-soft-deleted-models"},(0,r.kt)("a",{parentName:"h4",href:"#id-generating-soft-deleted-models"},"Generating soft deleted models"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("h4",{parentName:"li",id:"defining-relationships-within-factories"},(0,r.kt)("a",{parentName:"h4",href:"#id-defining-relationships-within-factories"},"Defining relationships within factories")))))),(0,r.kt)("h2",{id:"id-introduction"},"Introduction"),(0,r.kt)("p",null,"When testing your application or seeding your database, you may need to insert a few records into your database. Instead of manually specifying the value of each column,\nAthenna allows you to define a set of default attributes for each of your ",(0,r.kt)("a",{parentName:"p",href:"/docs/orm/getting-started"},(0,r.kt)("inlineCode",{parentName:"a"},"models"))," using model factories."),(0,r.kt)("h2",{id:"id-defining-model-factories"},"Defining model factories"),(0,r.kt)("p",null,"Before start using the static ",(0,r.kt)("inlineCode",{parentName:"p"},"factory")," method of models we need to define the static ",(0,r.kt)("inlineCode",{parentName:"p"},"definition")," method in our model. The ",(0,r.kt)("inlineCode",{parentName:"p"},"definition")," method returns the default set of attribute\nvalues that should be applied when creating a model using the factory, let's use as example the ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," model:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { Model } from '@athenna/database'\n\nexport class User extends Model {\n  static definition() {\n    return {\n      name: this.faker.name.fullName(),\n      email: this.faker.internet.email(),\n    }\n  }\n\n  /*...*/\n}\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"As you can see, we are using the static ",(0,r.kt)("inlineCode",{parentName:"p"},"faker")," attribute to create fake data for our ",(0,r.kt)("inlineCode",{parentName:"p"},"definition")," method. This attribute is using the ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@faker-js/faker"},(0,r.kt)("inlineCode",{parentName:"a"},"Faker library")),",\nthat is very used in applications to generate massive amounts of fake (but realistic) data for testing and development. You can check their documentation to generated more\nspecific types of data."))),(0,r.kt)("h2",{id:"id-generating-models-using-factories"},"Generating models using factories"),(0,r.kt)("h3",{id:"id-instantiating-models"},"Instantiating models"),(0,r.kt)("p",null,"Once you have defined your static ",(0,r.kt)("inlineCode",{parentName:"p"},"definition")," method, you may use the static ",(0,r.kt)("inlineCode",{parentName:"p"},"factory")," method of your models in order to instantiate a factory instance for that model. Let's\ntake a look at a few examples of creating models. First, we'll use the ",(0,r.kt)("inlineCode",{parentName:"p"},"make")," method to create models without persisting them to the database:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { User } from '#app/Models/User'\n\nconst user = await User.factory().make()\n")),(0,r.kt)("p",null,"You may create an array of many models using the ",(0,r.kt)("inlineCode",{parentName:"p"},"count")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const users = await User.factory().count(3).make()\n")),(0,r.kt)("h3",{id:"id-overriding-attributes"},"Overriding attributes"),(0,r.kt)("p",null,"If you would like to override some default values of your models, you may pass a record of values to the ",(0,r.kt)("inlineCode",{parentName:"p"},"make")," method. Only the specified attributes will be replaced while\nthe rest of the attributes remain set to their default values as specified by the static ",(0,r.kt)("inlineCode",{parentName:"p"},"definition")," method of your model:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const user = await User.factory()\n    .make({\n        email: 'danrley.morais@kadabra.school'\n    })\n")),(0,r.kt)("h3",{id:"id-persisting-models"},"Persisting models"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"create")," method instantiates model instances and persists them to the database:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// Create a single User instance\nconst user = await User.factory().create()\n\n// Create three User instances\nconst users = await User.factory().count(3).create()\n")),(0,r.kt)("h3",{id:"id-generating-soft-deleted-models"},"Generating soft deleted models"),(0,r.kt)("p",null,"If your model can be softly deleted, you may invoke the built-in ",(0,r.kt)("inlineCode",{parentName:"p"},"trashed"),' state method to indicate that the created model should already be "soft deleted":'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const user = await User.factory().trashed().make()\nconst user = await User.factory().trashed().create()\n")),(0,r.kt)("h3",{id:"id-defining-relationships-within-factories"},"Defining relationships within factories"),(0,r.kt)("p",null,'To define a relationship within your model factory, you will typically assign a new factory instance to the foreign key of the relationship. This is normally done for the\n"inverse" relationships such as ',(0,r.kt)("inlineCode",{parentName:"p"},"belongsTo")," relationships. For example, if you would like to create a new user when creating a post, you may do the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { User } from '#app/Models/User'\nimport { Model } from '@athenna/database'\n\nexport class Post extends Model {\n  static definition() {\n    const returningKey = 'id'\n\n    return {\n      title: this.faker.commerce.productName(),\n      userId: User.factory(returningKey)\n    }\n  }\n\n  /*...*/\n}\n")),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"returningKey")," will be used to return that specific value when executing your relationship factory, check this example:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const returningKey = \'id\'\n\n// The "user.id" will be returned from the "create"\n// method and assigned in the "userId" constant.\nconst userId = await User.factory(returningKey).create()\n')))))}p.isMDXComponent=!0}}]);