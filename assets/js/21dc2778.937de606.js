"use strict";(self.webpackChunk_athenna_docs=self.webpackChunk_athenna_docs||[]).push([[6295],{6807:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var i=t(4848),a=t(8453);const o={title:"Migrations",sidebar_position:3,description:"See how to create and run database migrations in Athenna Framework."},r="Database: Migrations",s={id:"database/migrations",title:"Migrations",description:"See how to create and run database migrations in Athenna Framework.",source:"@site/docs/database/migrations.mdx",sourceDirName:"database",slug:"/database/migrations",permalink:"/docs/database/migrations",draft:!1,unlisted:!1,editUrl:"https://github.com/AthennaIO/Docs/tree/main/docs/database/migrations.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Migrations",sidebar_position:3,description:"See how to create and run database migrations in Athenna Framework."},sidebar:"tutorialSidebar",previous:{title:"Query Builder",permalink:"/docs/database/query-builder"},next:{title:"Seeding",permalink:"/docs/database/seeding"}},c={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Generating migrations",id:"generating-migrations",level:2},{value:"Migration structure",id:"migration-structure",level:2},{value:"Setting the migration connection",id:"setting-the-migration-connection",level:3},{value:"Running migrations",id:"running-migrations",level:2},{value:"Reverting",id:"reverting",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"database-migrations",children:"Database: Migrations"}),"\n",(0,i.jsx)(n.p,{children:"See how to create and run database migrations in Athenna Framework."}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"Migrations are like version control for your database, allowing your\nteam to define and share the application's database schema\ndefinition. If you have ever had to tell a teammate to manually add a\ncolumn to their local database schema after pulling in your changes\nfrom source control, you've faced the problem that database migrations\nsolve."}),"\n",(0,i.jsx)(n.h2,{id:"generating-migrations",children:"Generating migrations"}),"\n",(0,i.jsxs)(n.p,{children:["You may use the ",(0,i.jsx)(n.code,{children:"make:migration"})," Artisan command to generate a database migration. The new migration will be placed in your\n",(0,i.jsx)(n.code,{children:"Path.migrations()"})," directory. Each migration filename contains a\ntimestamp that allows Athenna to determine the order of\nthe migrations:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node artisan make:migration FlightsMigration \n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Migrations templates may be customized using the\n",(0,i.jsx)(n.a,{href:"https://athenna.io/docs/the-basics/cli/commands#registering-custom-templates",children:(0,i.jsx)(n.strong,{children:"template customization command"})}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"migration-structure",children:"Migration structure"}),"\n",(0,i.jsxs)(n.p,{children:["A migration class contains two methods: ",(0,i.jsx)(n.code,{children:"up()"})," and ",(0,i.jsx)(n.code,{children:"down()"}),". The ",(0,i.jsx)(n.code,{children:"up()"}),"\nmethod is used to add new tables, columns, or indexes to your\ndatabase, while the ",(0,i.jsx)(n.code,{children:"down()"})," method should reverse the operations\nperformed by the ",(0,i.jsx)(n.code,{children:"up()"})," method."]}),"\n",(0,i.jsxs)(n.p,{children:["Within both of these methods, you may use the ",(0,i.jsx)(n.a,{href:"https://knexjs.org/guide/schema-builder.html",children:(0,i.jsx)(n.code,{children:"knex schema builder"})})," to\nexpressively create and modify tables. For example, the following migration creates a ",(0,i.jsx)(n.code,{children:"flights"})," table:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { BaseMigration, type DatabaseImpl } from '@athenna/database'\n\nexport class FlightsMigration extends BaseMigration {\n  public tableName = 'flights'\n\n  public async up(db: DatabaseImpl) {\n    return db.createTable(this.tableName, (table) => {\n      table.increments('id')\n      table.string('name')\n      table.string('airline')\n      table.timestamps(true, true, true)\n    })\n  }\n\n  public async down({ schema }: DatabaseImpl) {\n    return db.dropTableIfExists(this.tableName)\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"setting-the-migration-connection",children:"Setting the migration connection"}),"\n",(0,i.jsxs)(n.p,{children:["If your migration will be interacting with a database connection\nother than your application's default database connection,\nyou should set the static getter ",(0,i.jsx)(n.code,{children:"connection"})," in your migration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { BaseMigration, type DatabaseImpl } from '@athenna/database'\n\nexport class FlightsMigration extends BaseMigration { \n  public static connection() {\n    return 'postgres'\n  }\n\n  public async up(db: DatabaseImpl) {\n    // ...\n  }\n\n  public async down(db: DatabaseImpl) {\n    // ...\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"running-migrations",children:"Running migrations"}),"\n",(0,i.jsxs)(n.p,{children:["To run all of your outstanding migrations, execute the\n",(0,i.jsx)(n.code,{children:"migration:run"})," Artisan command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node artisan migration:run\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can use the ",(0,i.jsx)(n.code,{children:"--connection"})," option to run migrations\nfor a specific connection:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node artisan migration:run --connection=postgres\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"postgres"})," is your default connection then all the migrations\nusing the ",(0,i.jsx)(n.code,{children:"default"})," value in the static ",(0,i.jsx)(n.code,{children:"connection()"})," method\nwill run too."]})}),"\n",(0,i.jsx)(n.h2,{id:"reverting",children:"Reverting"}),"\n",(0,i.jsxs)(n.p,{children:["To revert all your migrations, you may use the ",(0,i.jsx)(n.code,{children:"migration:revert"}),"\nArtisan command. This command will revert all your migrations:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node artisan migration:revert\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can use the ",(0,i.jsx)(n.code,{children:"--connection"})," option to revert migrations for a\nspecific connection:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node artisan migration:revert --connection=postgres\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"postgres"})," is your default connection than all the migrations\nusing the ",(0,i.jsx)(n.code,{children:"default"})," value in the static ",(0,i.jsx)(n.code,{children:"connection()"})," method\nwill be reverted too."]})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>s});var i=t(6540);const a={},o=i.createContext(a);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);