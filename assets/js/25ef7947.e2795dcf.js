"use strict";(self.webpackChunk_athenna_docs=self.webpackChunk_athenna_docs||[]).push([[4180],{590:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var o=n(5893),i=n(1151);const r={title:"Error Handling",sidebar_position:5,description:"Understand how you can handle the errors of the REST API application."},s="Error Handling",l={id:"rest-api-application/error-handling",title:"Error Handling",description:"Understand how you can handle the errors of the REST API application.",source:"@site/docs/rest-api-application/error-handling.mdx",sourceDirName:"rest-api-application",slug:"/rest-api-application/error-handling",permalink:"/docs/rest-api-application/error-handling",draft:!1,unlisted:!1,editUrl:"https://github.com/AthennaIO/Docs/tree/main/docs/rest-api-application/error-handling.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Error Handling",sidebar_position:5,description:"Understand how you can handle the errors of the REST API application."},sidebar:"tutorialSidebar",previous:{title:"Request Context",permalink:"/docs/rest-api-application/request-context"},next:{title:"Annotations",permalink:"/docs/rest-api-application/annotations"}},c={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Http exceptions",id:"http-exceptions",level:2},{value:"The <code>HttpException</code> class",id:"the-httpexception-class",level:3},{value:"Ignore exceptions by status and code",id:"ignore-exceptions-by-status-and-code",level:3},{value:"Custom exceptions",id:"custom-exceptions",level:2},{value:"Implementing your own exception handler",id:"implementing-your-own-exception-handler",level:2}];function a(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"error-handling",children:"Error Handling"}),"\n",(0,o.jsx)(t.p,{children:"Understand how you can handle the errors of the REST API application."}),"\n",(0,o.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(t.p,{children:"When you start a new Athenna project, error and exception\nhandling is already configured for you. But you can configure\nyour own extending the Athenna error handler. We'll dive deeper\ninto how to do that throughout this documentation."}),"\n",(0,o.jsxs)(t.p,{children:["This documentation will cover about error handling in the ",(0,o.jsx)(t.strong,{children:"REST API"}),"\napplication, which means that only errors that happens inside\nroutes and bellow that will be handled:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",metastring:"title=\"Path.routes('http.ts')\"",children:"import { Route } from '@athenna/http'\n\n// If AppController.show throws, HttpExceptionHandler will handle it \ud83d\udc48\nRoute.get('/', 'AppController.show')\n\nRoute.get('/users', () => {\n  throw new Error('HttpExceptionHandler will handle this.') \ud83d\udc48\n})\n\nthrow new Error('This error will be handled by @athenna/core.') \ud83d\udc48\n"})}),"\n",(0,o.jsx)(t.admonition,{type:"info",children:(0,o.jsxs)(t.p,{children:["Errors handled by ",(0,o.jsx)(t.code,{children:"@athenna/core"})," usually means that a\nbootstrap failure has been found in your application."]})}),"\n",(0,o.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"debug"})," option in your ",(0,o.jsx)(t.code,{children:"Path.config('app.ts')"})," configuration\nfile determines how much information about an error is\nactually displayed to the user. By default, this option is\nset to respect the value of the ",(0,o.jsx)(t.code,{children:"APP_DEBUG"})," environment\nvariable, which is stored in your ",(0,o.jsx)(t.code,{children:".env"})," file."]}),"\n",(0,o.jsxs)(t.p,{children:["During local development, you should set the ",(0,o.jsx)(t.code,{children:"APP_DEBUG"}),"\nenvironment variable to ",(0,o.jsx)(t.code,{children:"true"}),". In your production\nenvironment, this value should always be ",(0,o.jsx)(t.code,{children:"false"}),". If the\nvalue is set to ",(0,o.jsx)(t.code,{children:"true"})," in production, you risk exposing\nsensitive configuration values to your application's end\nusers."]}),"\n",(0,o.jsxs)(t.p,{children:["Every error will be logged by default using the ",(0,o.jsx)(t.code,{children:"console"}),"\ndriver from ",(0,o.jsx)(t.code,{children:"@athenna/logger"}),". By default, Athenna uses the\n",(0,o.jsx)(t.code,{children:"exception"})," channel of your ",(0,o.jsx)(t.code,{children:"Path.config('logging.ts')"})," file to log\nall exceptions that happens in your application."]}),"\n",(0,o.jsx)(t.admonition,{type:"tip",children:(0,o.jsxs)(t.p,{children:["You can change the driver and formatter of ",(0,o.jsx)(t.code,{children:"exception"}),"\nchannel inside ",(0,o.jsx)(t.code,{children:"Path.config('logging.ts')"})," file. This way you can\nsend all your error logs to another provider and with\na different formatter."]})}),"\n",(0,o.jsx)(t.h2,{id:"http-exceptions",children:"Http exceptions"}),"\n",(0,o.jsxs)(t.p,{children:["In ",(0,o.jsx)(t.code,{children:"@athenna/http"})," package there are exported the most\ncommon exception that a http application might throw when\nbuilding one. These exceptions were created based on its\nstatus code and the meaning of it:"]}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{style:{textAlign:"left"},children:"Status code"}),(0,o.jsx)(t.th,{style:{textAlign:"right"},children:"Exception Class"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"400"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"BadRequestException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"401"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"UnauthorizedException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"403"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"ForbiddenException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"404"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"NotFoundException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"405"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"MethodNotAllowedException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"406"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"NotAcceptableException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"408"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"RequestTimeoutException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"413"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"PayloadTooLargeException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"422"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"UnprocessableEntityException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"500"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"InternalServerException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"501"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"NotImplementedException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"502"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"BadGatewayException"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"503"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"ServiceUnavailableException"})]})]})]}),"\n",(0,o.jsxs)(t.h3,{id:"the-httpexception-class",children:["The ",(0,o.jsx)(t.code,{children:"HttpException"})," class"]}),"\n",(0,o.jsxs)(t.p,{children:["All of the above exceptions where created from\n",(0,o.jsx)(t.code,{children:"HttpException"})," class, which is the base class to create\ncustom http exceptions. If you need to create some http\nexception from a status code that is not present above,\ncreate it extending ",(0,o.jsx)(t.code,{children:"HttpException"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"import { HttpException } from '@athenna/http'\n\nexport class PaymentRequiredException extends HttpException {\n  public constructor(message = 'Payment required.') {\n    const status = 402\n    const help = undefined\n    const code = 'E_PAYMENT_REQUIRED_ERROR'\n\n    super({ code, help, status, message })\n  }\n}\n"})}),"\n",(0,o.jsx)(t.h3,{id:"ignore-exceptions-by-status-and-code",children:"Ignore exceptions by status and code"}),"\n",(0,o.jsxs)(t.p,{children:["You can ignore an exception from being logged if its status\ncode or the code does not match your requirements. To do so\nyou can add the following configurations to the ",(0,o.jsx)(t.code,{children:"logger"}),"\nproperty in your ",(0,o.jsx)(t.code,{children:"Path.config('http.ts')"})," configuration file:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"export default {\n  logger: {\n    enabled: Env('LOG_HTTP', true),\n    ignoreStatuses: [404],\n    ignoreCodes: ['E_NOT_FOUND_ERROR']\n  }\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["From now on, all the exceptions thrown in your http\napplication will not be logged if its status is equal\nto ",(0,o.jsx)(t.code,{children:"404"})," or the code is ",(0,o.jsx)(t.code,{children:"E_NOT_FOUND_ERROR"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"custom-exceptions",children:"Custom exceptions"}),"\n",(0,o.jsx)(t.p,{children:"You can create custom exception by executing the following\nArtisan command:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"node artisan make:exception NotFoundResourceException\n"})}),"\n",(0,o.jsx)(t.p,{children:"Next, import and raise the exception as follows."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"import { NotFoundResourceException } from '#app/exceptions/NotFoundResourceException'\n\nthrow new NotFoundResourceException('Your resource has not been found.')\n"})}),"\n",(0,o.jsx)(t.admonition,{type:"tip",children:(0,o.jsxs)(t.p,{children:["Always try to use a custom exception to throw your errors\ninside Athenna. If you use ",(0,o.jsx)(t.code,{children:"Error"}),", ",(0,o.jsx)(t.code,{children:"TypeError"})," and other\nclasses, it will not be treated by the handlers and will\nalways be considered as a not treated exception."]})}),"\n",(0,o.jsx)(t.h2,{id:"implementing-your-own-exception-handler",children:"Implementing your own exception handler"}),"\n",(0,o.jsx)(t.p,{children:"Let's suppose you want to write a custom logic for handling\nyour exceptions. You can do so by creating your own\nexception handler:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",metastring:'title="app/http/exceptions/Handler.ts"',children:"import { type ErrorContext, HttpExceptionHandler } from '@athenna/http'\n\nexport class Handler extends HttpExceptionHandler {\n  public async handle(ctx: ErrorContext) {\n      // Implement your own logic\n  }\n}\n"})}),"\n",(0,o.jsx)(t.p,{children:"Now you need to register your exception handler when\nbootstrapping your application:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",metastring:"title=\"Path.bootstrap('main.ts')\"",children:"await ignite.httpServer({\n  exceptionHandlerPath: '#app/http/exceptions/Handler' \ud83d\udc48\n})\n"})})]})}function h(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>l,a:()=>s});var o=n(7294);const i={},r=o.createContext(i);function s(e){const t=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(r.Provider,{value:t},e.children)}}}]);