"use strict";(self.webpackChunk_athenna_docs=self.webpackChunk_athenna_docs||[]).push([[7345],{4913:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var n=i(4848),r=i(8453);const s={title:"Rate Limiting",sidebar_position:7,description:"See how to create rate limiting rules for Athenna REST API application."},a="Rate Limiting",o={id:"rest-api-application/rate-limiting",title:"Rate Limiting",description:"See how to create rate limiting rules for Athenna REST API application.",source:"@site/docs/rest-api-application/rate-limiting.mdx",sourceDirName:"rest-api-application",slug:"/rest-api-application/rate-limiting",permalink:"/docs/rest-api-application/rate-limiting",draft:!1,unlisted:!1,editUrl:"https://github.com/AthennaIO/Docs/tree/main/docs/rest-api-application/rate-limiting.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"Rate Limiting",sidebar_position:7,description:"See how to create rate limiting rules for Athenna REST API application."},sidebar:"tutorialSidebar",previous:{title:"Annotations",permalink:"/docs/rest-api-application/annotations"},next:{title:"Tracing Requests",permalink:"/docs/rest-api-application/tracing-requests"}},l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Basic usage",id:"basic-usage",level:2},{value:"Configuring for specific routes",id:"configuring-for-specific-routes",level:2},{value:"Usage in route groups",id:"usage-in-route-groups",level:3},{value:"Usage in route resources",id:"usage-in-route-resources",level:3},{value:"Rate limit headers",id:"rate-limit-headers",level:2},{value:"Disabling rate limiting",id:"disabling-rate-limiting",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,n.jsx)(t.p,{children:"See how to create rate-limiting rules for Athenna REST API application."}),"\n",(0,n.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,n.jsx)(t.p,{children:"Rate limiters ensure the fair usage of your http\nserver by clients. It regulates the number of times\na user can request your application in a given time-frame."}),"\n",(0,n.jsx)(t.h2,{id:"basic-usage",children:"Basic usage"}),"\n",(0,n.jsxs)(t.p,{children:["Athenna uses the ",(0,n.jsx)(t.a,{href:"https://github.com/fastify/fastify-rate-limit",children:(0,n.jsx)(t.code,{children:"@fastify/rate-limit"})}),"\nplugin inside ",(0,n.jsx)(t.code,{children:"HttpKernel"}),". All the configurations that\n",(0,n.jsx)(t.code,{children:"@fastify/rate-limit"})," supports can be set inside ",(0,n.jsx)(t.code,{children:"Path.config('http.ts')"}),"\nfile in the ",(0,n.jsx)(t.code,{children:"rateLimit"})," object:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",metastring:"title=\"Path.config('http.ts')\"",children:"export default {\n  rateLimit: {\n    global: true,\n    max: 1000,\n    ban: null,\n    timeWindow: 1000 * 60,\n    cache: 5000,\n    allowList: [],\n    continueExceeding: false,\n    enableDraftSpec: false\n  }\n}\n"})}),"\n",(0,n.jsx)(t.h2,{id:"configuring-for-specific-routes",children:"Configuring for specific routes"}),"\n",(0,n.jsxs)(t.p,{children:["In Athenna you can set specific options of rate limit\nfor specific routes. You can also disable the ",(0,n.jsx)(t.code,{children:"global"}),"\noption of your ",(0,n.jsx)(t.code,{children:"rateLimit"})," configuration in ",(0,n.jsx)(t.code,{children:"Path.config('http.ts')"}),"\nand set different rules in your routes:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",metastring:"title=\"Path.route('http.ts')\"",children:"Route\n  .get('/hello', 'WelcomeController.show')\n  .rateLimit({ max: 1, timeWindow: '1 minute' }) \ud83d\udc48\n"})}),"\n",(0,n.jsx)(t.h3,{id:"usage-in-route-groups",children:"Usage in route groups"}),"\n",(0,n.jsxs)(t.p,{children:["You can also use the ",(0,n.jsx)(t.code,{children:"rateLimit()"})," method in route groups.\nThis will set the same configuration for all routes inside\nthe group:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",metastring:"title=\"Path.route('http.ts')\"",children:"Route.group(() => {\n    Route.get('/hello', 'WelcomeController.show')\n}).rateLimit({ max: 1, timeWindow: '1 minute' }) \ud83d\udc48\n"})}),"\n",(0,n.jsx)(t.admonition,{type:"warning",children:(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"rateLimit()"}),' method of route groups will never\noverwrite the already set methods of routes. Use it\nto create "defaults" configurations for all routes.']})}),"\n",(0,n.jsx)(t.h3,{id:"usage-in-route-resources",children:"Usage in route resources"}),"\n",(0,n.jsx)(t.p,{children:"Same behavior as route groups, but for resources:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",metastring:"title=\"Path.route('http.ts')\"",children:"// Set the same configurations for all routes of resource\nRoute.resource('/tests', 'WelcomeController').rateLimit({...})\n\n// Set configuration only for that specific action of resource\nRoute.resource('/tests', 'WelcomeController').rateLimit('index', {...})\nRoute.resource('/tests', 'WelcomeController').rateLimit('store', {...})\n"})}),"\n",(0,n.jsx)(t.h2,{id:"rate-limit-headers",children:"Rate limit headers"}),"\n",(0,n.jsxs)(t.p,{children:["The response will have the following headers\nif ",(0,n.jsx)(t.code,{children:"enableDraftSpec"})," is true in ",(0,n.jsx)(t.code,{children:"rateLimit"})," config or route:"]}),"\n",(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Header"}),(0,n.jsx)("th",{children:"Description"})]})}),(0,n.jsxs)("tbody",{children:[(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"ratelimit-limit"})}),(0,n.jsx)("td",{children:"How many requests the client can make"})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"ratelimit-remaining"})}),(0,n.jsx)("td",{children:"How many requests remain to the client in the timewindow"})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"ratelimit-reset"})}),(0,n.jsx)("td",{children:"How many seconds must pass before the rate limit resets"})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"retry-after"})}),(0,n.jsxs)("td",{children:["Contains the same value in time as ",(0,n.jsx)("code",{children:"ratelimit-reset"})]})]})]})]}),"\n",(0,n.jsx)(t.admonition,{type:"tip",children:(0,n.jsxs)(t.p,{children:["For more information on Rate limit headers, please\nconsult the ",(0,n.jsx)(t.a,{href:"https://developers.facebook.com/docs/graph-api/overview/rate-limiting/",children:"Meta article about rate limiters"}),"."]})}),"\n",(0,n.jsx)(t.h2,{id:"disabling-rate-limiting",children:"Disabling rate limiting"}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"HttpKernel"})," class will automatically disable the\nplugin registration if the package does not exist, so\nto disable rate-limiting in Athenna you need to remove the\n",(0,n.jsx)(t.code,{children:"@fastify/rate-limit"})," package from your application:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"npm remove @fastify/rate-limit\n"})}),"\n",(0,n.jsxs)(t.p,{children:["You can also disable by setting ",(0,n.jsx)(t.code,{children:"http.rateLimit.enabled"})," to ",(0,n.jsx)(t.code,{children:"false"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",metastring:"title=\"Path.config('http.ts')\"",children:"export default {\n  rateLimit: {\n    enabled: false\n  }\n}\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>o});var n=i(6540);const r={},s=n.createContext(r);function a(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);