"use strict";(self.webpackChunk_athenna_docs=self.webpackChunk_athenna_docs||[]).push([[1680],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return u}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var m=a.createContext({}),l=function(e){var n=a.useContext(m),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=l(e.components);return a.createElement(m.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,m=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=l(t),u=i,h=p["".concat(m,".").concat(u)]||p[u]||c[u]||o;return t?a.createElement(h,r(r({ref:n},d),{},{components:t})):a.createElement(h,r({ref:n},d))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=p;var s={};for(var m in n)hasOwnProperty.call(n,m)&&(s[m]=n[m]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var l=2;l<o;l++)r[l]=t[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},6662:function(e,n,t){t.r(n),t.d(n,{contentTitle:function(){return m},default:function(){return p},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return d}});var a=t(7462),i=t(3366),o=(t(7294),t(3905)),r=["components"],s={sidebar_position:2,id:"commands",title:"Commands",hide_title:!0,hide_table_of_contents:!0,tags:["Getting Started","Architecture Concepts","The Basics"]},m=void 0,l={unversionedId:"the-basics/cli/commands",id:"the-basics/cli/commands",title:"Commands",description:"\ud83c\udfe0",source:"@site/docs/the-basics/cli/commands.mdx",sourceDirName:"the-basics/cli",slug:"/the-basics/cli/commands",permalink:"/docs/the-basics/cli/commands",editUrl:"https://github.com/AthennaIO/Docs/docs/the-basics/cli/commands.mdx",tags:[{label:"Getting Started",permalink:"/docs/tags/getting-started"},{label:"Architecture Concepts",permalink:"/docs/tags/architecture-concepts"},{label:"The Basics",permalink:"/docs/tags/the-basics"}],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,id:"commands",title:"Commands",hide_title:!0,hide_table_of_contents:!0,tags:["Getting Started","Architecture Concepts","The Basics"]},sidebar:"tutorialSidebar",previous:{title:"Routing",permalink:"/docs/the-basics/cli/routing"},next:{title:"Running",permalink:"/docs/the-basics/cli/running"}},d=[{value:"Introduction",id:"id-introduction",children:[],level:2},{value:"Writing commands",id:"id-writing-commands",children:[{value:"Generating commands",id:"id-generating-commands",children:[],level:3},{value:"Commands structure",id:"id-commands-structure",children:[],level:3},{value:"Defining input expectations",id:"id-defining-input-expectations",children:[],level:3},{value:"Registering commands",id:"id-registering-commands",children:[],level:3},{value:"Registering custom templates",id:"id-registering-custom-templates",children:[],level:3},{value:"Calling commands in runtime",id:"id-calling-commands-in-runtime",children:[],level:3}],level:2}],c={toc:d};function p(e){var n=e.components,t=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("nav",{"aria-label":"breadcrumbs"},(0,o.kt)("ul",{class:"breadcrumbs"},(0,o.kt)("li",{class:"breadcrumbs__item"},(0,o.kt)("a",{class:"breadcrumbs__link",href:"/"},"\ud83c\udfe0")),(0,o.kt)("li",{class:"breadcrumbs__item"},(0,o.kt)("a",{class:"breadcrumbs__link"},"The Basics")),(0,o.kt)("li",{class:"breadcrumbs__item"},(0,o.kt)("a",{class:"breadcrumbs__link"},"Cli")),(0,o.kt)("li",{class:"breadcrumbs__item"},(0,o.kt)("a",{class:"breadcrumbs__link",href:"/docs/the-basics/cli/commands"},"Commands")))),(0,o.kt)("span",{class:"badge badge--secondary margin-top-bot"},"version 1.0.0"),(0,o.kt)("h1",{id:"commands"},"Commands"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"introduction"},(0,o.kt)("a",{parentName:"h4",href:"#id-introduction"},"Introduction"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"writing-commands"},(0,o.kt)("a",{parentName:"h4",href:"#id-writing-commands"},"Writing commands")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"generating-commands"},(0,o.kt)("a",{parentName:"h4",href:"#id-generating-commands"},"Generating commands"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"commands-structure"},(0,o.kt)("a",{parentName:"h4",href:"#id-commands-structure"},"Commands structure"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"defining-input-expectation"},(0,o.kt)("a",{parentName:"h4",href:"#id-defining-input-expectations"},"Defining input expectation"))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"registering-commands"},(0,o.kt)("a",{parentName:"h4",href:"#id-registering-commands"},"Registering commands"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"registering-custom-templates"},(0,o.kt)("a",{parentName:"h4",href:"#id-registering-custom-templates"},"Registering custom templates"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"calling-commands-in-runtime"},(0,o.kt)("a",{parentName:"h4",href:"#id-calling-commands-in-runtime"},"Calling commands in runtime")))),(0,o.kt)("h2",{id:"id-introduction"},"Introduction"),(0,o.kt)("p",null,"In Athenna there is a more advanced way to create commands than just a closure command inside ",(0,o.kt)("inlineCode",{parentName:"p"},"routes/console")," file. You\njust need to extend the abstract class ",(0,o.kt)("inlineCode",{parentName:"p"},"Command")," and implement her methods."),(0,o.kt)("h2",{id:"id-writing-commands"},"Writing commands"),(0,o.kt)("p",null,"In addition to the commands provided with Artisan, you may build your own custom commands. Commands are typically stored\nin the ",(0,o.kt)("inlineCode",{parentName:"p"},"app/Console/Commands")," directory; however, you are free to choose your own storage location as long as your commands\ncan be imported."),(0,o.kt)("h3",{id:"id-generating-commands"},"Generating commands"),(0,o.kt)("p",null,"To create a new command, you may use the ",(0,o.kt)("inlineCode",{parentName:"p"},"make:command")," Artisan command. This command will create a new command class in\nthe ",(0,o.kt)("inlineCode",{parentName:"p"},"app/Console/Commands")," directory and register it inside ",(0,o.kt)("inlineCode",{parentName:"p"},"commands")," method of ",(0,o.kt)("inlineCode",{parentName:"p"},"app/Console/Kernel.js")," file. Don't worry\nif this directory does not exist in your application - it will be created the first time you run the ",(0,o.kt)("inlineCode",{parentName:"p"},"make:command")," Artisan command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"node artisan make:command SendEmails\n")),(0,o.kt)("h3",{id:"id-commands-structure"},"Commands structure"),(0,o.kt)("p",null,"After generating your command, you should define appropriate values for the ",(0,o.kt)("inlineCode",{parentName:"p"},"signature")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"description")," properties of the\nclass. These properties will be used when displaying your command on the list screen. The ",(0,o.kt)("inlineCode",{parentName:"p"},"signature")," property also\nallows you to define your command's arguments expectations. The ",(0,o.kt)("inlineCode",{parentName:"p"},"handle")," method will be called when your command is executed.\nYou may place your command logic in this method."),(0,o.kt)("p",null,"Let's take a look at an example command. Note that we are able to request any dependencies we need via the command's constructor\nmethod. The Athenna service container will automatically inject all dependencies inside the container property of constructor:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import { Command } from '@athenna/artisan'\n\nexport class SendEmails extends Command {\n  /**\n   * The name and signature of the console command.\n   *\n   * @return {string}\n   */\n  get signature() {\n      return 'mail:send <email>'\n  }\n\n  /**\n   * The console command description.\n   *\n   * @return {string}\n   */\n  get description() {\n      return 'Display welcome object.'\n  }\n\n  /**\n   * The welcome service dependency.\n   *\n   * @type {import('#app/Services/MailgunService').MailgunService}\n   */\n  #mailgunService\n\n  /**\n   * Use the constructor to resolve any dependency of the Ioc container.\n   *\n   * @param {any} mailgunService\n   */\n  constructor(mailgunService) {\n    super()\n\n    this.#mailgunService = mailgunService\n  }\n\n  /**\n   * Execute the console command.\n   *\n   * @param {string} email\n   */\n  async handle(email) {\n    const message = 'Hello from Athenna!'\n\n    await this.#mailgunService.send(email, message)\n  }\n}\n")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},'For greater code reuse, it is good practice keeping your console commands light and let them defer to application services\nto accomplish their tasks. In the example above, note that we inject a service class to do the "heavy lifting" of sending the e-mails.'))),(0,o.kt)("h3",{id:"id-defining-input-expectations"},"Defining input expectations"),(0,o.kt)("p",null,"When writing console commands, it is common to gather input from the user through arguments or options. Athenna makes it\nvery convenient to define the input you expect from the user using the ",(0,o.kt)("inlineCode",{parentName:"p"},"addFlags")," method on your commands. The ",(0,o.kt)("inlineCode",{parentName:"p"},"addFlags"),"\nmethod allows you to define any additional flag from ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/commander"},(0,o.kt)("inlineCode",{parentName:"a"},"commander")),". Check out their\ndocumentation to see all the flags available for your. See the example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import { Command } from '@athenna/artisan'\n\nexport class SendEmails extends Command {\n  /**\n   * The name and signature of the console command.\n   *\n   * @return {string}\n   */\n  get signature() {\n      return 'mail:send <email>'\n  }\n\n  /**\n   * The console command description.\n   *\n   * @return {string}\n   */\n  get description() {\n      return 'Display welcome object.'\n  }\n\n  /**\n   * The welcome service dependency.\n   *\n   * @type {import('#app/Services/MailgunService').MailgunService}\n   */\n   #mailgunService\n\n  /**\n   * Use the constructor to resolve any dependency of the Ioc container.\n   *\n   * @param {any} mailgunService\n   */\n  constructor(mailgunService) {\n    super()\n\n    this.#mailgunService = mailgunService\n  }\n\n  /**\n   * Set additional flags in the commander instance.\n   * This method is executed when registering your command.\n   *\n   * @param {import('commander').Command} commander\n   * @return {import('commander').Command}\n   */\n  public addFlags(commander) {\n    const signature = '-s, --subject <subject>'\n    const description = 'Set the subject of the email.'\n    const defaultValue = 'Athenna'\n\n    return commander.option(signature, description, defaultValue)\n  }\n\n  /**\n   * Execute the console command.\n   *\n   * @param {string} email\n   * @param {any} options\n   */\n  async handle(email, options) {\n    const message = 'Hello from Athenna!'\n\n    await this.#mailgunService.send(email, message, options.subject)\n  }\n}\n")),(0,o.kt)("h3",{id:"id-registering-commands"},"Registering commands"),(0,o.kt)("p",null,"All of your console commands are registered within your application's ",(0,o.kt)("inlineCode",{parentName:"p"},"app/Console/Kernel.js"),' class, which is your application\'s\n"console kernel".'),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"ArtisanLoader")," will register all the commands that come with Artisan such as ",(0,o.kt)("inlineCode",{parentName:"p"},"node artisan serve")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"node artisan make:provider"),".\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpLoader")," will load all commands from ",(0,o.kt)("inlineCode",{parentName:"p"},"@athenna/http")," package, such as, ",(0,o.kt)("inlineCode",{parentName:"p"},"node artisan route:list")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"node artisan make:controller"),".\nWe call this type of commands as internal commands."),(0,o.kt)("p",null,"By default, Athenna will import all commands inside ",(0,o.kt)("inlineCode",{parentName:"p"},"app/Console/Commands")," folder and import it using ",(0,o.kt)("inlineCode",{parentName:"p"},"Folder")," helper, so you don't\nneed to mind about registering your command in Kernel. We call this type of commands as application commands."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * Register the commands for the application.\n *\n * @return {any[]}\n */\nget commands() {\n    const internalCommands = [\n      ...ArtisanLoader.loadCommands(),\n      ...HttpLoader.loadCommands(),\n      ...TestLoader.loadCommands(),\n      ...CoreLoader.loadCommands(),\n    ]\n\n    const appCommands = new Folder(Path.console('Commands'))\n      .loadSync()\n      .getFilesByPattern('**/*.js', true)\n      .map(command => import(command.href))\n\n    return [...internalCommands, ...appCommands]\n}\n")),(0,o.kt)("h3",{id:"id-registering-custom-templates"},"Registering custom templates"),(0,o.kt)("p",null,"The Artisan console's ",(0,o.kt)("inlineCode",{parentName:"p"},"make"),' commands are used to create a variety of classes, such as controllers, middlewares, commands, and tests.\nThese classes are generated using "templates" files that are populated with values based on your input. However, you may want\nto make small changes to files generated by Artisan or even set your own templates to use in your custom ',(0,o.kt)("inlineCode",{parentName:"p"},"make")," commands."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"template:customize")," command will download all the templates that are set in the ",(0,o.kt)("inlineCode",{parentName:"p"},"get templates")," method inside ",(0,o.kt)("inlineCode",{parentName:"p"},"app/Console/Kernel.js"),"\nand copy it to the ",(0,o.kt)("inlineCode",{parentName:"p"},"resources/templates")," folder in our project root:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"node artisan template:customize\n")),(0,o.kt)("p",null,"Now in our ",(0,o.kt)("inlineCode",{parentName:"p"},"resources/templates")," folder we have the ",(0,o.kt)("inlineCode",{parentName:"p"},"exception.edge")," file, let's create a custom template for it that removes\nall comments of the class:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ejs"},"import { Exception } from '@athenna/core'\n\nexport class {{ namePascal }}Exception extends Exception {\n  constructor(message, statusCode, code, help) {\n    super(message, statusCode, code, help)\n  }\n}\n")),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Remember that the file name needs to be ",(0,o.kt)("inlineCode",{parentName:"p"},"exception.edge")," to be replaced by Artisan original template."))),(0,o.kt)("p",null,"By default, ",(0,o.kt)("inlineCode",{parentName:"p"},"ArtisanLoader.loadTemplates()")," method already load all the templates found inside your ",(0,o.kt)("inlineCode",{parentName:"p"},"resources/templates"),"\nfolder:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * Register custom templates files.\n *\n * @return {any[]}\n */\nget templates() {\n    return [\n      ...HttpLoader.loadTemplates(),\n      ...TestLoader.loadTemplates(),\n      ...ArtisanLoader.loadTemplates(),\n    ]\n}\n")),(0,o.kt)("p",null,"Now if we run the ",(0,o.kt)("inlineCode",{parentName:"p"},"node artisan make:exception")," command, Artisan will use our custom template to generate the exceptions files."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Remember to always leave ",(0,o.kt)("inlineCode",{parentName:"p"},"...ArtisanLoader.loadTemplates()")," at the end of the array to override the already set templates of\nother loaders like ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpLoader")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"TestLoader"),"."))),(0,o.kt)("h3",{id:"id-calling-commands-in-runtime"},"Calling commands in runtime"),(0,o.kt)("p",null,"Sometimes you may wish to call other commands from an existing Artisan command or from any other part of your application.\nYou may do so using the ",(0,o.kt)("inlineCode",{parentName:"p"},"call")," method from Artisan. This ",(0,o.kt)("inlineCode",{parentName:"p"},"call")," method accepts the command string with it arguments and options:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"await Artisan.call('make:controller TestController')\n")),(0,o.kt)("p",null,"If you want to verify if your command has generated some output in stdout or stderr you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"callInChild")," method:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const { stdout, stderr } = await Artisan.callInChild('make:controller TestController')\n\nassert.isTrue(stdout.includes('[ MAKING CONTROLLER ]'))\nassert.isUndefined(stderr)\n")))}p.isMDXComponent=!0}}]);