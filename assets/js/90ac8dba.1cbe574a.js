"use strict";(self.webpackChunk_athenna_docs=self.webpackChunk_athenna_docs||[]).push([[7412],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var i=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=i.createContext({}),s=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=s(e.components);return i.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=s(t),m=r,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||a;return t?i.createElement(h,o(o({ref:n},p),{},{components:t})):i.createElement(h,o({ref:n},p))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,o=new Array(a);o[0]=u;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:r,o[1]=c;for(var s=2;s<a;s++)o[s]=t[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},6753:function(e,n,t){t.r(n),t.d(n,{contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return c},metadata:function(){return s},toc:function(){return p}});var i=t(7462),r=t(3366),a=(t(7294),t(3905)),o=["components"],c={sidebar_position:2,id:"container",title:"Service Container",hide_title:!0,hide_table_of_contents:!0,tags:["Architecture Concepts"]},l=void 0,s={unversionedId:"architecture-concepts/container",id:"architecture-concepts/container",title:"Service Container",description:"\ud83c\udfe0",source:"@site/docs/architecture-concepts/container.mdx",sourceDirName:"architecture-concepts",slug:"/architecture-concepts/container",permalink:"/docs/architecture-concepts/container",editUrl:"https://github.com/AthennaIO/Docs/docs/architecture-concepts/container.mdx",tags:[{label:"Architecture Concepts",permalink:"/docs/tags/architecture-concepts"}],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,id:"container",title:"Service Container",hide_title:!0,hide_table_of_contents:!0,tags:["Architecture Concepts"]},sidebar:"tutorialSidebar",previous:{title:"Application Lifecycle",permalink:"/docs/architecture-concepts/lifecycle"},next:{title:"Service Providers",permalink:"/docs/architecture-concepts/providers"}},p=[{value:"Introduction",id:"id-introduction",children:[{value:"Zero configuration resolution",id:"id-zero-configuration-resolution",children:[],level:3},{value:"When to use the container",id:"id-when-to-use-the-container",children:[],level:3}],level:2},{value:"Binding",id:"id-binding",children:[{value:"Binding basics",id:"id-binding-basics",children:[{value:"Simple bindings",id:"simple-bindings",children:[],level:4},{value:"Binding a singleton",id:"binding-a-singleton",children:[],level:4},{value:"Binding instances",id:"binding-instances",children:[],level:4}],level:3}],level:2},{value:"Resolving",id:"id-resolving",children:[{value:"The global ioc class",id:"id-the-global-ioc-class",children:[],level:3},{value:"Automatic constructor injection",id:"id-automatic-constructor-injection",children:[],level:3}],level:2}],d={toc:p};function u(e){var n=e.components,t=(0,r.Z)(e,o);return(0,a.kt)("wrapper",(0,i.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("nav",{"aria-label":"breadcrumbs"},(0,a.kt)("ul",{class:"breadcrumbs"},(0,a.kt)("li",{class:"breadcrumbs__item"},(0,a.kt)("a",{class:"breadcrumbs__link",href:"/"},"\ud83c\udfe0")),(0,a.kt)("li",{class:"breadcrumbs__item"},(0,a.kt)("a",{class:"breadcrumbs__link"},"Architecture Concepts")),(0,a.kt)("li",{class:"breadcrumbs__item"},(0,a.kt)("a",{class:"breadcrumbs__link",href:"/docs/architecture-concepts/container"},"Service Container")))),(0,a.kt)("span",{class:"badge badge--secondary margin-top-bot"},"version 1.0.0"),(0,a.kt)("h1",{id:"service-container"},"Service Container"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("h4",{parentName:"li",id:"introduction"},(0,a.kt)("a",{parentName:"h4",href:"#id-introduction"},"Introduction")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("h4",{parentName:"li",id:"zero-configuration-resolution"},(0,a.kt)("a",{parentName:"h4",href:"#id-zero-configuration-resolution"},"Zero configuration resolution"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("h4",{parentName:"li",id:"when-to-use-the-container"},(0,a.kt)("a",{parentName:"h4",href:"#id-when-to-use-the-container"},"When to use the container"))))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("h4",{parentName:"li",id:"binding"},(0,a.kt)("a",{parentName:"h4",href:"#id-binding"},"Binding")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("h4",{parentName:"li",id:"binding-basics"},(0,a.kt)("a",{parentName:"h4",href:"#id-binding-basics"},"Binding basics"))))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("h4",{parentName:"li",id:"resolving"},(0,a.kt)("a",{parentName:"h4",href:"#id-resolving"},"Resolving")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("h4",{parentName:"li",id:"the-global-ioc-class"},(0,a.kt)("a",{parentName:"h4",href:"#id-the-global-ioc-class"},"The global ioc class"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("h4",{parentName:"li",id:"automatic-constructor-injection"},(0,a.kt)("a",{parentName:"h4",href:"#id-automatic-constructor-injection"},"Automatic constructor injection")))))),(0,a.kt)("h2",{id:"id-introduction"},"Introduction"),(0,a.kt)("p",null,'The Athenna service container is a powerful tool for managing class dependencies and performing dependency injection.\nDependency injection is a fancy phrase that essentially means this: class dependencies are "injected" into the class\nvia the constructor or, in some cases, "setter" methods.'),(0,a.kt)("p",null,"Let's look at a simple example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"export class WelcomeController {\n  /** @type {import('#app/Services/WelcomeService').WelcomeService} */\n  #welcomeService\n\n  /**\n   * Create a new controller instance.\n   *\n   * @param {any} welcomeService\n   */\n  constructor(welcomeService) {\n    this.#welcomeService = welcomeService\n  }\n\n  /**\n   * Show the welcome payload.\n   *\n   * @param {import('@athenna/http').ContextContract} ctx\n   */\n  async show({ response }) {\n    const data = await this.#welcomeService.findOne()\n\n    return response.status(200).send(data)\n  }\n}\n")),(0,a.kt)("p",null,"In this example, the ",(0,a.kt)("inlineCode",{parentName:"p"},"WelcomeController")," needs to retrieve the welcome payload from a data source. So, we will inject a\nservice that is able to retrieve the payload. In this context, our ",(0,a.kt)("inlineCode",{parentName:"p"},"WelcomeService"),". Since the ",(0,a.kt)("inlineCode",{parentName:"p"},"WelcomeService"),' is injected,\nwe are able to easily swap it out with another implementation. We are also able to easily "mock", or create a dummy\nimplementation of the ',(0,a.kt)("inlineCode",{parentName:"p"},"WelcomeService")," when testing our application."),(0,a.kt)("p",null,"A deep understanding of the Athenna service container is essential to building a powerful, large application, as well\nas for contributing to the Athenna core itself."),(0,a.kt)("h3",{id:"id-zero-configuration-resolution"},"Zero configuration resolution"),(0,a.kt)("p",null,"If the class that you are working is in the ",(0,a.kt)("inlineCode",{parentName:"p"},"app/Services")," directory, the container autoload this service because of the\n",(0,a.kt)("inlineCode",{parentName:"p"},"ServiceProvider")," class. For example, you may place the following code in your ",(0,a.kt)("inlineCode",{parentName:"p"},"routes/http")," file:"),(0,a.kt)("p",null,"If a class has no dependencies or only depends on other concrete classes (not interfaces), the container does not need\nto be instructed on how to resolve that class. For example, you may place the following code in your ",(0,a.kt)("inlineCode",{parentName:"p"},"routes/http")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { Route } from '@athenna/http'\n\nRoute.get('/welcome', async (ctx) => {\n    /** @type {import('#app/Services/WelcomeService').WelcomeService} */\n    const welcomeService = ioc.use('App/Services/WelcomeService')\n\n    return ctx.response.status(200).send(await welcomeService.findOne())\n})\n")),(0,a.kt)("p",null,"In this example, hitting your application's ",(0,a.kt)("inlineCode",{parentName:"p"},"/welcome")," route will automatically resolve the ",(0,a.kt)("inlineCode",{parentName:"p"},"WelcomeService")," class and\ninject it into your ",(0,a.kt)("inlineCode",{parentName:"p"},"welcomeService")," constant. This is game changing. It means you can develop your application and take\nadvantage of dependency injection without worrying about bloated configuration files."),(0,a.kt)("p",null,"Thankfully, many of the classes you will be writing when building an Athenna application automatically receive their\ndependencies via the container, including controllers, middleware, and more. Additionally. Once you taste the power of\nautomatic and zero configuration dependency injection it feels impossible to develop without it."),(0,a.kt)("h3",{id:"id-when-to-use-the-container"},"When to use the container"),(0,a.kt)("p",null,"In many cases, thanks to automatic dependency injection, you can build Athenna applications without ever manually binding\nor resolving anything from the container. So, when would you ever manually interact with the container? Let's examine two situations."),(0,a.kt)("p",null,"If you are writing an Athenna package that you plan to share with other Athenna developers, you may need to bind your\npackage's services into the container."),(0,a.kt)("h2",{id:"id-binding"},"Binding"),(0,a.kt)("h3",{id:"id-binding-basics"},"Binding basics"),(0,a.kt)("h4",{id:"simple-bindings"},"Simple bindings"),(0,a.kt)("p",null,"Almost all of your service container bindings will be registered within service providers, so most of these examples will\ndemonstrate using the container in that context."),(0,a.kt)("p",null,"Within a service provider, you always have access to the container via the ",(0,a.kt)("inlineCode",{parentName:"p"},"ioc")," global property. We can register a binding\nusing the ",(0,a.kt)("inlineCode",{parentName:"p"},"bind")," method, passing the alias name that we wish to register along with our dependency:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { StringNormalizer } from '#app/Utils/StringNormalizer'\n\nioc.bind('App/Utils/StringNormalizer', StringNormalizer)\n")),(0,a.kt)("h4",{id:"binding-a-singleton"},"Binding a singleton"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"singleton")," method binds a class or interface into the container that should only be resolved one time. Once a ",(0,a.kt)("inlineCode",{parentName:"p"},"singleton"),"\nbinding is resolved, the same object instance will be returned on subsequent calls into the container:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { StringNormalizer } from '#app/Utils/StringNormalizer'\n\nioc.singleton('App/Utils/StringNormalizer', StringNormalizer)\n")),(0,a.kt)("h4",{id:"binding-instances"},"Binding instances"),(0,a.kt)("p",null,"You may also bind an existing object instance into the container using the ",(0,a.kt)("inlineCode",{parentName:"p"},"instance")," method. The given instance will\nalways be returned on subsequent calls into the container:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { StringNormalizer } from '#app/Utils/StringNormalizer'\n\nioc.instance('App/Utils/StringNormalizer', new StringNormalizer())\n")),(0,a.kt)("h2",{id:"id-resolving"},"Resolving"),(0,a.kt)("h3",{id:"id-the-global-ioc-class"},"The global ioc class"),(0,a.kt)("p",null,"You may use the ",(0,a.kt)("inlineCode",{parentName:"p"},"use")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"safeUse")," method to resolve a class instance from the container. The ",(0,a.kt)("inlineCode",{parentName:"p"},"use")," method accepts the alias of the\ndependency you wish to resolve:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"/** @type {import('#app/Utils/StringNormalizer').StringNormalizer} */\nconst stringNormalized = ioc.use('App/Utils/StringNormalizer')\n")),(0,a.kt)("p",null,"If the dependency cannot be found, ",(0,a.kt)("inlineCode",{parentName:"p"},"stringNormalized")," will be ",(0,a.kt)("inlineCode",{parentName:"p"},"undefined"),". To throw errors when the dependency does not\nexist, use the ",(0,a.kt)("inlineCode",{parentName:"p"},"safeUse")," method."),(0,a.kt)("h3",{id:"id-automatic-constructor-injection"},"Automatic constructor injection"),(0,a.kt)("p",null,"Alternatively, and importantly, you can use the constructor of a class that is resolved by the container, including controllers,\nservices, middleware, and more. In practice, this is how most of your objects should be resolved by the container."),(0,a.kt)("p",null,"For example, you may add your provider name in camelCase in the controller's constructor. The service will automatically be resolved\nand injected into the class:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"export class WelcomeController {\n  /** @type {import('#app/Services/WelcomeService').WelcomeService} */\n  #welcomeService\n\n  /**\n   * Create a new controller instance.\n   *\n   * @param {any} welcomeService\n   */\n  constructor(welcomeService) {\n    this.#welcomeService = welcomeService\n  }\n\n  /**\n   * Show the welcome payload.\n   *\n   * @param {import('@athenna/http').ContextContract} ctx\n   */\n  async show({ response }) {\n    const data = await this.#welcomeService.findOne()\n\n    return response.status(200).send(data)\n  }\n}\n")))}u.isMDXComponent=!0}}]);