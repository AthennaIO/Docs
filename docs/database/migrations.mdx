---
sidebar_position: 3

id: migrations
title: Migrations
hide_title: true
hide_table_of_contents: true
tags:
- Database
- Migrations
---

<nav aria-label="breadcrumbs">
    <ul class="breadcrumbs">
        <li class="breadcrumbs__item">
            <a class="breadcrumbs__link" href="/">üè†</a>
        </li>
        <li class="breadcrumbs__item">
            <a class="breadcrumbs__link">Database</a>
        </li>
        <li class="breadcrumbs__item">
            <a class="breadcrumbs__link" href="/docs/database/migrations">Migrations</a>
        </li>
    </ul>
</nav>

<span class="badge badge--secondary margin-top-bot">version 1.0.0</span>

# Database: Migrations

- #### [Introduction](#id-introduction)
- #### [Generating migrations](#id-generating-migrations)
- #### [Migration structure](#id-migration-structure)
- #### [Running migrations](#id-running-migrations)
- #### [Reverting (Rolling back) migrations](#id-reverting-migrations)
- #### [The migration schema API](#id-the-migration-schema-api)

## Introduction {#id-introduction}

Migrations are like version control for your database, allowing your team to define and share the application's database schema
definition. If you have ever had to tell a teammate to manually add a column to their local database schema after pulling in
your changes from source control, you've faced the problem that database migrations solve.

## Generating migrations {#id-generating-migrations}

You may use the `make:migration` Artisan command to generate a database migration. The new migration will be placed in your
`database/migrations` directory. Each migration filename contains a timestamp that allows Athenna to determine the order of
the migrations:

```shell
node artisan make:migration create_flights_table
```

:::tip
Migrations templates may be customized using the
[`template customization command`](https://athenna.io/docs/the-basics/cli/commands#id-registering-custom-templates).
:::

## Migration structure {#id-migration-structure}

A migration class contains two methods: `up` and `down`. The `up` method is used to add new tables, columns, or indexes to
your database, while the `down` method should reverse the operations performed by the `up` method.

Within both of these methods, you may use the [`Knex schema builder`](https://knexjs.org/guide/schema-builder.html) to
expressively create and modify tables. For example, the following migration creates a `flights` table:

```javascript
import { Migration } from '@athenna/database'

export class CreateFlightsTable extends Migration {
    /**
     * Run the migration.
     *
     * @param {import('knex').Knex} knex
     * @return {Promise<void>}
     */
    async up({ schema }) {
        return schema.createTable('flights', table => {
            table.id()
            table.string('name')
            table.string('airline')
            table.timestamps(true, true, true)
        })
    }

    /**
     * Reverse the migration.
     *
     * @param {import('knex').Knex} knex
     * @return {Promise<void>}
     */
    async down({ schema }) {
         return schema.dropTableIfExists('flights')
    }
}
```

### Setting the migration connection {#id-setting-the-migration-connection}

If your migration will be interacting with a database connection other than your application's default database connection,
you should set the static getter `connection` in your migration:

```javascript
import { Migration } from '@athenna/database'

export class CreateFlightsTable extends Migration {
     /**
      * Define the database connection to run the migration.
      *
      * @return {string}
      */
     static get connection() {
        return 'postgres'
     }

    async up({ schema }) {
        // ...
    }

    async down({ schema }) {
        // ...
    }
}
```

## Running migrations {#id-running-migrations}

To run all of your outstanding migrations, execute the `migration:run` Artisan command:

```shell
node artisan migration:run
```

You can use the `--connection` argument to run migrations for a specific connection:

```shell
node artisan migration:run --connection=postgres
```

:::warning
If `postgres` is your default connection than all the migrations using the `default` value in the static getter `connection`
will run too.
:::

## Reverting (Rolling back) migrations {#id-reverting-migrations}

To revert all your migrations, you may use the `migration:revert` Artisan command. This command will revert all your migrations:

```shell
node artisan migration:revert
```

You can use the `--connection` argument to revert migrations for a specific connection:

```shell
node artisan migration:revert --connection=postgres
```

:::warning
If `postgres` is your default connection than all the migrations using the `default` value in the static getter `connection`
will be reverted too.
:::

## The migration schema API {#id-the-migration-schema-api}

If you wish to know more about the migrations API under the `schema` property of [`Knex`](https://knexjs.org) you can check the
[`Knex schema builder documentation`](https://knexjs.org/guide/schema-builder.html). Knex documentation is very good and will
be very useful for more advanced methods of schema builder API.

