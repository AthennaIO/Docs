---
sidebar_position: 5

id: factories
title: Factories
hide_title: true
hide_table_of_contents: true
tags:
- ORM
- Database
- Factories
---

<nav aria-label="breadcrumbs">
    <ul class="breadcrumbs">
        <li class="breadcrumbs__item">
            <a class="breadcrumbs__link" href="/">üè†</a>
        </li>
        <li class="breadcrumbs__item">
            <a class="breadcrumbs__link">ORM</a>
        </li>
        <li class="breadcrumbs__item">
            <a class="breadcrumbs__link" href="/docs/orm/factories">Factories</a>
        </li>
    </ul>
</nav>

<span class="badge badge--secondary margin-top-bot">version 1.0.0</span>

# ORM: Factories

- #### [Introduction](#id-introduction)
- #### [Defining model factories](#id-defining-model-factories)
- #### [Generating models using factories](#id-generating-models-using-factories)
    - #### [Instantiating models](#id-instantiating-models)
    - #### [Overriding attributes](#id-overriding-attributes)
    - #### [Persisting models](#id-persisting-models)
    - #### [Generating soft deleted models](#id-generating-soft-deleted-models)
    - #### [Defining relationships within factories](#id-defining-relationships-within-factories)

## Introduction {#id-introduction}

When testing your application or seeding your database, you may need to insert a few records into your database. Instead of manually specifying the value of each column,
Athenna allows you to define a set of default attributes for each of your [`models`](/docs/orm/getting-started) using model factories.

## Defining model factories {#id-defining-model-factories}

Before start using the static `factory` method of models we need to define the static `definition` method in our model. The `definition` method returns the default set of attribute
values that should be applied when creating a model using the factory, let's use as example the `User` model:

```javascript
import { Model } from '@athenna/database'

export class User extends Model {
  static definition() {
    return {
      name: this.faker.name.fullName(),
      email: this.faker.internet.email(),
    }
  }

  /*...*/
}
```

:::tip
As you can see, we are using the static `faker` attribute to create fake data for our `definition` method. This attribute is using the [`Faker library`](https://www.npmjs.com/package/@faker-js/faker),
that is very used in applications to generate massive amounts of fake (but realistic) data for testing and development. You can check their documentation to generated more
specific types of data.
:::

## Generating models using factories {#id-generating-models-using-factories}

### Instantiating models {#id-instantiating-models}

Once you have defined your static `definition` method, you may use the static `factory` method of your models in order to instantiate a factory instance for that model. Let's
take a look at a few examples of creating models. First, we'll use the `make` method to create models without persisting them to the database:

```javascript
import { User } from '#app/Models/User'

const user = await User.factory().make()
```

You may create an array of many models using the `count` method:

```javascript
const users = await User.factory().count(3).make()
```

### Overriding attributes {#id-overriding-attributes}

If you would like to override some default values of your models, you may pass a record of values to the `make` method. Only the specified attributes will be replaced while
the rest of the attributes remain set to their default values as specified by the static `definition` method of your model:

```javascript
const user = await User.factory()
    .make({
        email: 'danrley.morais@kadabra.school'
    })
```

### Persisting models {#id-persisting-models}

The `create` method instantiates model instances and persists them to the database:

```javascript
// Create a single User instance
const user = await User.factory().create()

// Create three User instances
const users = await User.factory().count(3).create()
```

### Generating soft deleted models {#id-generating-soft-deleted-models}

If your model can be softly deleted, you may invoke the built-in `trashed` state method to indicate that the created model should already be "soft deleted":

```javascript
const user = await User.factory().trashed().make()
const user = await User.factory().trashed().create()
```

### Defining relationships within factories {#id-defining-relationships-within-factories}

To define a relationship within your model factory, you will typically assign a new factory instance to the foreign key of the relationship. This is normally done for the
"inverse" relationships such as `belongsTo` relationships. For example, if you would like to create a new user when creating a post, you may do the following:

```javascript
import { User } from '#app/Models/User'
import { Model } from '@athenna/database'

export class Post extends Model {
  static definition() {
    const returningKey = 'id'

    return {
      title: this.faker.commerce.productName(),
      userId: User.factory(returningKey)
    }
  }

  /*...*/
}
```

:::warning
The `returningKey` will be used to return that specific value when executing your relationship factory, check this example:

```javascript
const returningKey = 'id'

// The "user.id" will be returned from the "create"
// method and assigned in the "userId" constant.
const userId = await User.factory(returningKey).create()
```
:::

