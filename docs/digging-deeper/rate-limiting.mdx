---
sidebar_position: 4

id: rate-limiting
title: Rate Limiting
hide_title: true
hide_table_of_contents: true
tags:
- Http
- Rate Limiting
- Digging Deeper
---

<nav aria-label="breadcrumbs">
    <ul class="breadcrumbs">
        <li class="breadcrumbs__item">
            <a class="breadcrumbs__link" href="/">üè†</a>
        </li>
        <li class="breadcrumbs__item">
            <a class="breadcrumbs__link">Digging Deeper</a>
        </li>
        <li class="breadcrumbs__item">
            <a class="breadcrumbs__link" href="/docs/digging-deeper/rate-limiting">Rate Limiting</a>
        </li>
    </ul>
</nav>

<span class="badge badge--secondary margin-top-bot">version 1.0.0</span>

# Rate Limiting

- #### [Introduction](#id-introduction)
- #### [Basic usage](#id-basic-usage)
  - #### [Set rate limit for specific routes](#id-set-rate-limit-for-specific-routes)
  - #### [Usage in route groups](#id-usage-in-route-groups)
  - #### [Usage in route resources](#id-usage-in-route-resources)
- #### [Disabling rate limit](#id-disabling-rate-limit)

## Introduction {#id-introduction}

Rate limiters ensure the fair usage of your http server by clients. It regulates the number of times a user can request
your application in a given time-frame.

## Basic usage {#id-basic-usage}

Athenna uses the [`@fastify/rate-limit`](https://github.com/fastify/fastify-rate-limit) plugin inside `HttpKernel`. All
the configurations that `@fastify/rate-limit` supports can be set inside `config/http.js` file in the `rateLimit` object:

```javascript
rateLimit: {
    global: true,
    max: 1000,
    ban: null,
    timeWindow: 1000 * 60,
    cache: 5000,
    allowList: [],
    continueExceeding: false,
    enableDraftSpec: false,
}
```

:::warning
We highly recommend opening the `config/http.js` file in `rateLimit` configurations to see a little documentation of all it's options.
:::

### Set rate limit for specific routes {#id-set-rate-limit-for-specific-routes}

In Athenna you can set specific options of rate limit for specific routes. You can also disable the `global` option of your
`rateLimit` configuration in `config/http.js` and set different rules in your routes:

```javascript
Route.get('/hello', 'WelcomeController.show').rateLimit({ max: 1, timeWindow: '1 minute' })
```

### Usage in route groups {#id-usage-in-route-groups}

In route groups you can use the `rateLimit` method. This will set the same configuration for all routes inside
the group:

```javascript
Route.group(() => {
    Route.get('/hello', 'WelcomeController.show')
}).rateLimit({...})
```

:::warning
The `rateLimit` method of route groups will never subscribe the already set methods of routes. Use then to create "defaults"
configurations for all routes.
:::

### Usage in route resources {#id-usage-in-route-resources}

In route resources you can use the `rateLimit` method:

```javascript
// Set the same configurations for all routes of resource
Route.resource('/tests', 'WelcomeController').rateLimit({...})

// Set configuration only for that specific action of resource
Route.resource('/tests', 'WelcomeController').rateLimit('index', {...})
Route.resource('/tests', 'WelcomeController').rateLimit('store', {...})
```

## Rate limit headers {#id-rate-limit-headers}

The response will have the following headers if `enableDraftSpec` is true in `rateLimit` config or route:

<table>
    <thead>
    <tr>
        <th>Header</th>
        <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><code>ratelimit-limit</code></td>
        <td>How many requests the client can make</td>
    </tr>
    <tr>
        <td><code>ratelimit-remaining</code></td>
        <td>How many requests remain to the client in the timewindow</td>
    </tr>
    <tr>
        <td><code>ratelimit-reset</code></td>
        <td>How many seconds must pass before the rate limit resets</td>
    </tr>
    <tr>
        <td><code>retry-after</code></td>
        <td>Contains the same value in time as <code>ratelimit-reset</code></td>
    </tr>
    </tbody>
</table>

:::tip
For more information on Rate limit headers, please consult the
[Meta article about rate limiters](https://developers.facebook.com/docs/graph-api/overview/rate-limiting/).
:::

## Disabling rate limit {#id-disabling-rate-limit}

Rate limit plugin is registered in your http application by default, but you can remove it setting the `noRateLimit` as
`true` in `config/http.js` file:

```javascript
noRateLimit: true
```
